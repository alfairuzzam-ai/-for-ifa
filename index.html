<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Untuk Sayang ğŸ¤</title>

  <style>
    :root{
      --pink1:#ffb3d9;
      --pink2:#ff5fb7;
      --pink3:#c35bff;
      --ink:#1b1020;
      --card:rgba(255,255,255,.18);
      --card2:rgba(255,255,255,.10);
      --line:rgba(255,255,255,.28);
      --txt:#fff;
      --muted:rgba(255,255,255,.85);
      --shadow:0 18px 60px rgba(0,0,0,.35);
      --radius:26px;
      --good:rgba(255,255,255,.92);
      --glass:rgba(255,255,255,.14);
      --glass2:rgba(255,255,255,.10);
      --danger:rgba(0,0,0,.18);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--txt);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      overflow:hidden;
      background: linear-gradient(135deg, var(--pink1), var(--pink2), var(--pink3));
    }

    /* soft moving glow */
    .glow{
      position:fixed; inset:-180px;
      background:
        radial-gradient(circle at 20% 15%, rgba(255,255,255,.22) 0 18%, transparent 45%),
        radial-gradient(circle at 75% 20%, rgba(255,255,255,.18) 0 16%, transparent 55%),
        radial-gradient(circle at 55% 80%, rgba(255,255,255,.14) 0 14%, transparent 55%);
      filter: blur(18px);
      animation: drift 10s ease-in-out infinite alternate;
      pointer-events:none;
      z-index:-5;
    }
    @keyframes drift{
      from{transform:translate3d(-1%, -1%, 0) scale(1)}
      to{transform:translate3d(1.2%, 1%, 0) scale(1.03)}
    }

    /* confetti hearts */
    .hearts{
      position:fixed; inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index:60;
    }
    .heart{
      position:absolute;
      font-size:18px;
      opacity:0;
      animation: floatUp 3.2s ease-in forwards;
      filter: drop-shadow(0 8px 16px rgba(0,0,0,.25));
      will-change: transform, opacity;
    }
    @keyframes floatUp{
      0%{transform:translate3d(0, 18px,0) scale(.9); opacity:0}
      12%{opacity:.95}
      100%{transform:translate3d(0, -240px,0) scale(1.2); opacity:0}
    }

    /* App & screens */
    .app{position:relative;height:100%;width:100%}
    .screen{
      position:absolute; inset:0;
      display:grid;
      place-items:center;
      padding:24px;
      opacity:0;
      pointer-events:none;
      transform:translate3d(0, 18px, 0) scale(.985);
      transition: opacity .55s ease, transform .55s ease;
    }
    .screen.active{
      opacity:1;
      pointer-events:auto;
      transform:translate3d(0,0,0) scale(1);
    }
    .screen.leaving{
      opacity:0;
      transform:translate3d(0, -10px,0) scale(.99);
      pointer-events:none;
    }

    /* Global background slides (12 & fotbar) */
    .bgSlides{
      position:fixed;
      inset:0;
      z-index:-4;
      overflow:hidden;
      display:none; /* enabled only when needed */
    }
    .bgSlides.on{display:block}
    .bgSlides .slide{
      position:absolute; inset:-10%;
      background-size:cover;
      background-position:center;
      opacity:0;
      transition: opacity 1.1s ease;
      filter:saturate(1.05) contrast(1.02);
      will-change: transform, opacity;
    }
    .bgSlides .slide.show{
      opacity:1;
      animation: kenburns 7.8s ease-in-out forwards;
    }
    .bgSlides .slide:nth-child(even).show{animation-name: kenburns2}
    @keyframes kenburns{
      from{transform:scale(1.03) translate3d(-1.2%, .6%, 0)}
      to{transform:scale(1.12) translate3d(1.2%, -0.6%, 0)}
    }
    @keyframes kenburns2{
      from{transform:scale(1.04) translate3d(1.0%, .8%, 0)}
      to{transform:scale(1.12) translate3d(-1.0%, -0.8%, 0)}
    }

    /* Overlay for readability */
    .overlay{
      position:fixed; inset:0;
      z-index:-3;
      display:none;
      background: radial-gradient(900px 600px at 50% 20%, rgba(255,255,255,.10), transparent 55%),
                  linear-gradient(180deg, rgba(0,0,0,.22), rgba(0,0,0,.42));
    }
    .overlay.on{display:block}

    /* Cards */
    .card{
      width:min(920px, 96vw);
      background:var(--card2);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .card .inner{padding:22px 20px 20px}
    .title{
      font-size:clamp(28px, 4.2vw, 48px);
      font-weight:800;
      letter-spacing:.2px;
      text-align:center;
      text-shadow:0 10px 40px rgba(0,0,0,.25);
      margin:0 0 10px;
    }
    .subtitle{
      text-align:center;
      font-size:clamp(14px, 2.2vw, 18px);
      color:var(--muted);
      line-height:1.55;
      margin:0 0 16px;
    }

    .row{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      justify-content:center;
      align-items:center;
    }

    /* Inputs & buttons */
    input{
      width:min(420px, 88vw);
      padding:14px 14px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.38);
      outline:none;
      background:rgba(255,255,255,.18);
      color:#fff;
      font-size:16px;
      backdrop-filter: blur(8px);
    }
    input::placeholder{color:rgba(255,255,255,.78)}

    .btn{
      border:none;
      cursor:pointer;
      padding:14px 18px;
      border-radius:16px;
      font-weight:800;
      font-size:15px;
      color:#fff;
      background: linear-gradient(135deg, rgba(255,255,255,.28), rgba(255,255,255,.12));
      border:1px solid rgba(255,255,255,.45);
      box-shadow: 0 12px 40px rgba(0,0,0,.18);
      transition: transform .15s ease, filter .15s ease;
      user-select:none;
    }
    .btn:hover{transform:translateY(-1px); filter:brightness(1.05)}
    .btn:active{transform:translateY(1px) scale(.99)}
    .btn.primary{background: linear-gradient(135deg, rgba(255,255,255,.40), rgba(255,255,255,.14))}
    .btn.danger{background: linear-gradient(135deg, rgba(0,0,0,.20), rgba(255,255,255,.10))}
    .btn.pulse{animation: pulse 1.6s ease-in-out infinite}
    @keyframes pulse{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-1px) scale(1.03)}}

    /* Lock */
    .lockWrap{display:grid;place-items:center;padding:18px 10px 0}
    .lock{
      width:110px; height:110px;
      display:grid; place-items:center;
      border-radius:26px;
      background:rgba(255,255,255,.18);
      border:1px solid rgba(255,255,255,.35);
      box-shadow:0 20px 60px rgba(0,0,0,.18);
      position:relative;
    }
    .lock .icon{font-size:58px;transform:translateY(2px);transition: transform .4s ease}
    .lock.unlocked .icon{transform:translateY(2px) scale(1.05)}
    .shake{animation: shake .45s ease}
    @keyframes shake{
      0%,100%{transform:translateX(0)}
      20%{transform:translateX(-8px)}
      40%{transform:translateX(8px)}
      60%{transform:translateX(-6px)}
      80%{transform:translateX(6px)}
    }
    .errorText{
      text-align:center;
      margin-top:10px;
      font-weight:700;
      color:rgba(255,255,255,.95);
      min-height:22px;
    }

    /* Screen content blocks (message cards) */
    .msgBox{
      width:min(860px, 96vw);
      background:rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.28);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:22px 18px;
      backdrop-filter: blur(10px);
    }
    .msgText{
      font-size:clamp(18px, 2.6vw, 28px);
      font-weight:900;
      line-height:1.32;
      text-align:center;
      margin:0 0 12px;
      text-shadow:0 10px 26px rgba(0,0,0,.22);
    }
    .msgSub{
      text-align:center;
      color:rgba(255,255,255,.9);
      font-size:15px;
      line-height:1.65;
      margin:0 0 14px;
      white-space:pre-wrap;
    }

    /* Birthday screen */
    .centerStack{
      display:grid;
      justify-items:center;
      gap:12px;
      padding:18px 10px 8px;
    }
    .cake{font-size:78px;line-height:1;filter: drop-shadow(0 14px 40px rgba(0,0,0,.25));user-select:none}
    .miniRow{display:flex; gap:10px; align-items:center; justify-content:center;font-size:24px;opacity:.95}
    .loveFloat{
      position:fixed;
      bottom:18px; left:0; right:0;
      text-align:center;
      font-size:18px;
      color:rgba(255,255,255,.92);
      text-shadow:0 10px 24px rgba(0,0,0,.25);
      opacity:.9;
      pointer-events:none;
    }

    /* Question */
    .twoBtns{display:flex; gap:12px; justify-content:center; flex-wrap:wrap}
    .notice{
      text-align:center;
      margin-top:10px;
      min-height:50px;
      white-space:pre-wrap;
      color:rgba(255,255,255,.92);
      font-weight:800;
    }

    /* Candle game */
    .gameWrap{
      width:min(920px, 96vw);
      border-radius:var(--radius);
      overflow:hidden;
      position:relative;
    }
    .gameInner{
      padding:22px 18px 18px;
      background:rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.28);
      backdrop-filter: blur(10px);
      box-shadow:var(--shadow);
    }
    .flameArea{display:grid;justify-items:center;gap:10px;margin-top:6px}
    .flame{
      width:34px; height:46px;
      border-radius:18px 18px 18px 18px;
      background: radial-gradient(circle at 45% 35%, rgba(255,255,255,.95), rgba(255,205,100,.98) 35%, rgba(255,96,96,.96) 70%);
      filter: drop-shadow(0 14px 30px rgba(0,0,0,.25));
      cursor:pointer;
      position:relative;
      animation: flicker .18s ease-in-out infinite alternate;
      transform-origin: 50% 90%;
      user-select:none;
      will-change: transform, opacity;
    }
    .flame::after{
      content:"";
      position:absolute;
      inset:6px 9px 12px 9px;
      border-radius:14px;
      background: radial-gradient(circle at 40% 30%, rgba(255,255,255,.9), rgba(255,205,100,.9) 55%, transparent 80%);
      opacity:.9;
    }
    @keyframes flicker{from{transform:rotate(-2deg) scale(1)}to{transform:rotate(2deg) scale(1.03)}}
    .smoke{
      font-size:22px;
      opacity:0;
      transform:translateY(6px);
      transition: opacity .6s ease, transform .6s ease;
      user-select:none;
    }
    .smoke.show{opacity:.95;transform:translateY(0)}
    .cheer{
      margin-top:10px;
      text-align:center;
      min-height:30px;
      font-weight:900;
      color:rgba(255,255,255,.92);
    }

    /* Progress bar (candle) */
    .bar{
      width:min(520px, 92%);
      height:12px;
      border-radius:999px;
      background:rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.22);
      overflow:hidden;
      box-shadow:0 12px 30px rgba(0,0,0,.12);
    }
    .bar > i{
      display:block;
      height:100%;
      width:0%;
      background:linear-gradient(90deg, rgba(255,255,255,.55), rgba(255,255,255,.25));
      border-radius:999px;
      transition:width .18s ease;
    }

    /* Typewriter screens */
    .letter{
      width:min(920px, 96vw);
      background:rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.28);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      backdrop-filter: blur(10px);
      padding:22px 18px;
      display:flex;
      flex-direction:column;
      gap:10px;
      height:min(78vh, 720px);
    }
    .typed{
      white-space:pre-wrap;
      font-size:16px;
      line-height:1.8;
      color:rgba(255,255,255,.97);
      margin:0;
      flex:1;
      overflow:auto;
      padding-right:6px;
      text-shadow:0 10px 26px rgba(0,0,0,.18);
    }
    .cursor{display:inline-block;width:10px;animation: blink 1s step-end infinite;opacity:.9}
    @keyframes blink{ 50%{opacity:0} }

    .hidden{display:none !important}
    .tiny{
      margin-top:10px;
      text-align:center;
      font-size:12px;
      color:rgba(255,255,255,.86);
      opacity:.95;
    }

    /* Mobile tweaks */
    @media (max-width:480px){
      .card .inner{padding:18px 16px 16px}
      .cake{font-size:68px}
      .miniRow{font-size:22px}
      .typed{font-size:15px}
    }
  </style>
</head>

<body>
  <div class="glow"></div>
  <div class="hearts" id="hearts"></div>

  <!-- AUDIO -->
  <audio id="romantis" src="romantis.mp3" preload="auto"></audio>
  <audio id="birthday" src="happybirthday.mp3" preload="auto"></audio>
  <audio id="lagu3" src="lagu3.mp3" preload="auto"></audio>

  <!-- BACKGROUND 12 FOTO (jalan sampai pesan ultah selesai) -->
  <div class="bgSlides" id="slides12">
    <div class="slide" style="background-image:url('foto1.jpeg')"></div>
    <div class="slide" style="background-image:url('foto2.jpeg')"></div>
    <div class="slide" style="background-image:url('foto3.jpg')"></div>
    <div class="slide" style="background-image:url('foto4.jpg')"></div>
    <div class="slide" style="background-image:url('foto5.jpg')"></div>
    <div class="slide" style="background-image:url('foto6.jpg')"></div>
    <div class="slide" style="background-image:url('foto7.jpg')"></div>
    <div class="slide" style="background-image:url('foto8.jpg')"></div>
    <div class="slide" style="background-image:url('foto9.jpeg')"></div>
    <div class="slide" style="background-image:url('foto10.jpeg')"></div>
    <div class="slide" style="background-image:url('foto11.jpeg')"></div>
    <div class="slide" style="background-image:url('foto12.jpeg')"></div>
  </div>

  <!-- BACKGROUND FOTBAR (muncul setelah tombol lanjut di pesan ultah) -->
  <div class="bgSlides" id="slidesFotbar">
    <div class="slide" style="background-image:url('foto3.jpg')"></div>
    <div class="slide" style="background-image:url('foto4.jpg')"></div>
    <div class="slide" style="background-image:url('foto5.jpg')"></div>
    <div class="slide" style="background-image:url('foto12.jpeg')"></div>
  </div>

  <div class="overlay" id="overlay"></div>

  <div class="app">

    <!-- SCREEN 1: LOCK -->
    <section class="screen active" id="s1_lock">
      <div class="card">
        <div class="inner">
          <div class="lockWrap">
            <div class="lock" id="lockBox" aria-hidden="true">
              <div class="icon" id="lockIcon">ğŸ”’</div>
            </div>
          </div>

          <h1 class="title">Password Cinta</h1>
          <p class="subtitle">Masukin password-nya dulu ya sayang ğŸ¤</p>

          <div class="row">
            <input id="pw" type="password" placeholder="kata kunci..." autocomplete="off" />
          </div>

          <!-- SESUAI PERMINTAAN: cuma â€œkata kunciâ€, tidak ditampilkan password/hint -->
          <div class="tiny">kata kunci: (tentang kamu sayang ğŸ¤)</div>

          <div class="row" style="margin-top:14px;">
            <button class="btn primary pulse" id="btnUnlock">BUKA ğŸ’–</button>
          </div>

          <div class="errorText" id="pwErr"></div>
        </div>
      </div>
    </section>

    <!-- SCREEN 2: START -->
    <section class="screen" id="s2_start">
      <div class="card">
        <div class="inner">
          <h1 class="title">Pencet tombol mulainya ya, sayangâ€¦</h1>
          <p class="subtitle">janji dehâ€¦ gabakal nyesel kok ğŸ¤</p>
          <div class="row">
            <button class="btn primary pulse" id="btnStart">MULAI ğŸ’—</button>
          </div>
          <div class="tiny">klik tombolnya ya biar musik bisa jalan ğŸ¶</div>
        </div>
      </div>
    </section>

    <!-- SCREEN 3: BDAY + 12 PHOTO SLIDES + ROMANTIS AUDIO -->
    <section class="screen" id="s3_bday">
      <div class="card">
        <div class="inner">
          <div class="centerStack">
            <h1 class="title" style="margin-bottom:2px;">Selamat Ulang Tahun, Sayangku ğŸ¤</h1>
            <div class="miniRow">â¤ï¸ ğŸ•¯ï¸ ğŸ‚ â¤ï¸</div>
            <div class="cake" aria-hidden="true">ğŸ‚</div>
            <p class="subtitle" style="margin:0 0 8px;">hari ini spesial bangetâ€¦ dan ini buat kamu âœ¨</p>
            <button class="btn primary pulse" id="btnToMsg1">LANJUT ğŸ’—</button>
          </div>
        </div>
      </div>
      <div class="loveFloat">love you more than you know ğŸ¤</div>
    </section>

    <!-- SCREEN 4: ROMANTIS 1 -->
    <section class="screen" id="s4_msg1">
  <div class="msgBox">
    <p class="msgText">â€œMakasih yaâ€¦â€</p>
    <p class="msgSub">
      kamu udah sejauh ini bareng aku ğŸ¤<br>
      klik lanjut ya sayangâ€¦
    </p>
    <div class="row">
      <button class="btn primary pulse" data-next="s5_msg2">LANJUT ğŸ’—</button>
    </div>
  </div>
</section>


    <!-- SCREEN 5: ROMANTIS 2 -->
    <section class="screen" id="s5_msg2">
      <div class="msgBox">
        <p class="msgText">â€œAku tau capek itu adaâ€¦â€</p>
        <p class="msgSub">tapi kamu hebat banget bisa bertahan ğŸ«¶</p>
        <div class="row"><button class="btn primary pulse" data-next="s6_msg3">LANJUT LAGI ğŸ’•</button></div>
      </div>
    </section>

    <!-- SCREEN 6: ROMANTIS 3 -->
    <section class="screen" id="s6_msg3">
      <div class="msgBox">
        <p class="msgText">â€œKalau dunia lagi beratâ€¦â€</p>
        <p class="msgSub">pulangnya ke aku aja ya ğŸ¤</p>
        <div class="row"><button class="btn primary pulse" data-next="s7_msg4">LANJUT âœ¨</button></div>
      </div>
    </section>

    <!-- SCREEN 7: ROMANTIS 4 -->
    <section class="screen" id="s7_msg4">
      <div class="msgBox">
        <p class="msgText">â€œAku bangga sama kamu.â€ ğŸ¥¹</p>
        <p class="msgSub">seriusâ€¦ aku bangga banget ğŸ¤</p>
        <div class="row"><button class="btn primary pulse" data-next="s8_msg5">LANJUT ğŸ’–</button></div>
      </div>
    </section>

    <!-- SCREEN 8: ROMANTIS 5 -->
    <section class="screen" id="s8_msg5">
  <div class="msgBox">
    <p class="msgText">â€œAku mau kitaâ€¦â€</p>
    <p class="msgSub">
      bareng terus yaâ€¦<br>
      sampai nanti ğŸ«¶
    </p>
    <div class="row">
      <button class="btn primary pulse" data-next="s9_msg6">LANJUT ğŸ˜†</button>
    </div>
  </div>
</section>


    <!-- SCREEN 9: ROMANTIS 6 -->
    <section class="screen" id="s9_msg6">
      <div class="msgBox">
        <p class="msgText">â€œOkeâ€¦ siap yaâ€¦â€</p>
        <p class="msgSub">ini masuk yang seru ğŸ˜†</p>
        <div class="row"><button class="btn primary pulse" data-next="s10_question">MASUK ğŸ˜†ğŸ’˜</button></div>
      </div>
    </section>

    <!-- SCREEN 10: QUESTION -->
    <section class="screen" id="s10_question">
      <div class="msgBox">
        <p class="msgText">Kamu sayang aku kan? ğŸ’Œâ¤ï¸ğŸ¥º</p>
        <p class="msgSub">jawab jujur yaâ€¦</p>

        <div class="twoBtns">
          <button class="btn primary" id="btnYes">IYA ğŸ’–</button>
          <button class="btn danger" id="btnNo">TIDAK ğŸ’”</button>
        </div>

        <div class="notice" id="qNotice"></div>

        <div class="row">
          <button class="btn primary hidden" id="btnQNext">LANJUT ğŸ’</button>
          <button class="btn hidden" id="btnRetry">ULANGI ğŸ˜…</button>
        </div>
      </div>
    </section>

    <!-- SCREEN 11: CANDLE GAME -->
    <section class="screen" id="s11_candle">
      <div class="gameWrap">
        <div class="gameInner">
          <h1 class="title" style="margin:0 0 6px;">Tiup Lilinnya ya, Sayang ğŸ‚</h1>
          <p class="subtitle" style="margin:0 0 12px;">Tap apinya beberapa kali sampai padam ya sayang ğŸ’•</p>

          <div class="flameArea">
            <div class="miniRow" style="font-size:24px;">â¤ï¸ ğŸ•¯ï¸ ğŸ‚ â¤ï¸</div>

            <div style="position:relative; display:grid; place-items:center; gap:8px;">
              <div class="cake" style="font-size:86px;">ğŸ‚</div>
              <div class="flame" id="flame" title="tap api"></div>
              <div class="smoke" id="smoke">ğŸŒ«ï¸</div>
            </div>

            <div class="bar" aria-label="progress">
              <i id="barFill"></i>
            </div>
          </div>

          <div class="cheer" id="cheer">Heheâ€¦ pelan-pelan ya ğŸ˜†</div>

          <div class="row" style="margin-top:12px;">
            <button class="btn primary hidden" id="btnCandleNext">LANJUT ğŸ’</button>
          </div>
        </div>
      </div>
    </section>

    <!-- SCREEN 12: TYPEWRITER BDAY LETTER -->
    <section class="screen" id="s12_letter">
      <div class="letter">
        <h1 class="title" style="margin:0;">ğŸ¤</h1>
        <p class="subtitle" style="margin:0;">baca pelan-pelan ya sayangâ€¦</p>
        <pre class="typed" id="typed"></pre>
        <div class="row">
          <button class="btn primary hidden" id="btnLetterNext">LANJUT ğŸ¤</button>
        </div>
      </div>
    </section>

    <!-- SCREEN 13: FOTBAR FINAL (bg 4 foto + lagu3 + type paling pelan) -->
    <section class="screen" id="s13_fotbar">
      <div class="msgBox">
        <p class="msgText">ini sayang baca ini baik-baik yaaâ€¦</p>
        <p class="msgSub" id="fotbarTyped"></p>
        <div class="row" style="margin-top:14px;">
          <button class="btn primary pulse" id="btnRestart">ULANGI DARI AWAL ğŸ¤</button>
        </div>
        <div class="tiny">selesaiâ€¦ tapi aku tetep sayang kamu ğŸ¤</div>
      </div>
    </section>

  </div>

  <script>
    /* =========================
       Helpers
    ========================== */
    const $ = (s) => document.querySelector(s);
    const sleep = (ms) => new Promise(r => setTimeout(r, ms));

    /* =========================
       State
    ========================== */
    const state = {
      current: "s1_lock",
      slidesTimer12: null,
      slidesTimerFotbar: null,
      candleTaps: 0,
      candleTarget: 12,           // lebih detail (boleh 10-14)
      typingRunning: false,
      audioNow: null,
    };

    /* =========================
       Hearts
    ========================== */
    const hearts = $("#hearts");
    function burstHearts(n=10){
      for(let i=0;i<n;i++){
        const el = document.createElement("div");
        el.className = "heart";
        el.textContent = ["â¤ï¸","ğŸ’—","ğŸ’–","ğŸ’","ğŸ’•","ğŸ«¶"][Math.floor(Math.random()*6)];
        const x = Math.random()*100;
        const y = 70 + Math.random()*25;
        el.style.left = x + "vw";
        el.style.top = y + "vh";
        el.style.fontSize = (14 + Math.random()*18) + "px";
        el.style.animationDuration = (2.6 + Math.random()*1.8) + "s";
        hearts.appendChild(el);
        setTimeout(()=> el.remove(), 3800);
      }
    }

    /* =========================
       Screen navigation
    ========================== */
    function goTo(nextId){
      const current = document.getElementById(state.current);
      const next = document.getElementById(nextId);
      if (!current || !next) return;

      current.classList.add("leaving");
      burstHearts(8);

      setTimeout(()=>{
        current.classList.remove("active","leaving");
        next.classList.add("active");
        state.current = nextId;
      }, 520);
    }

    /* =========================
       Slideshow
    ========================== */
    function stopTimer(t){ if(t) clearInterval(t); return null; }

    function startSlideshow(containerId, interval=4500){
      const slides = [...document.querySelectorAll(`#${containerId} .slide`)];
      if(!slides.length) return null;

      let i = 0;
      slides.forEach(s => s.classList.remove("show"));
      slides[0].classList.add("show");

      return setInterval(()=>{
        slides[i].classList.remove("show");
        i = (i+1) % slides.length;
        slides[i].classList.add("show");
      }, interval);
    }

    function enableBg(which){
      const s12 = $("#slides12");
      const sf  = $("#slidesFotbar");
      const ov  = $("#overlay");

      // disable both first
      s12.classList.remove("on");
      sf.classList.remove("on");

      if(which === "12"){
        s12.classList.add("on");
        ov.classList.add("on");
      } else if(which === "fotbar"){
        sf.classList.add("on");
        ov.classList.add("on");
      } else {
        ov.classList.remove("on");
      }
    }

    /* =========================
       Audio (fade in/out) + start at 9s
    ========================== */
    const aud = {
      romantis: $("#romantis"),
      birthday: $("#birthday"),
      lagu3: $("#lagu3"),
    };

    async function ensureMeta(a){
      if (a.readyState >= 1) return;
      await new Promise(res => a.addEventListener("loadedmetadata", res, { once:true }));
    }

    async function fadeTo(a, target=1, ms=600){
      const steps = 18;
      const stepMs = ms/steps;
      const start = (typeof a.volume === "number") ? a.volume : 1;
      for(let i=1;i<=steps;i++){
        a.volume = start + (target-start)*(i/steps);
        await sleep(stepMs);
      }
      a.volume = target;
    }

    async function stopAllAudio(){
      for(const a of Object.values(aud)){
        a.pause();
        try { a.currentTime = 0; } catch(e){}
        a.volume = 1;
      }
      state.audioNow = null;
    }

    async function switchAudio(id){
      // fade out current
      if(state.audioNow && state.audioNow !== id){
        const cur = aud[state.audioNow];
        try{
          await fadeTo(cur, 0, 380);
          cur.pause();
          cur.currentTime = 0;
          cur.volume = 1;
        }catch(e){}
      }

      const a = aud[id];
      await ensureMeta(a);

      // start from 9s
      try { a.currentTime = 9; } catch(e){}
      a.volume = 0;
      state.audioNow = id;

      try { await a.play(); } catch(e){
        // must be called from user gesture; our calls are from click handlers
      }
      await fadeTo(a, 1, 650);
    }

    /* =========================
       Password (UI tanpa tampilkan password)
    ========================== */
    const pw = $("#pw");
    const pwErr = $("#pwErr");
    const lockBox = $("#lockBox");
    const lockIcon = $("#lockIcon");
    const PASS = "sayang ifa"; // tidak ditampilkan di UI

    function wrongPw(msg){
      lockBox.classList.add("shake");
      pwErr.textContent = msg;
      setTimeout(()=> lockBox.classList.remove("shake"), 460);
    }

    $("#btnUnlock").addEventListener("click", ()=>{
      const val = (pw.value||"").trim().toLowerCase();
      if(val === PASS){
        pwErr.textContent = "";
        lockIcon.textContent = "ğŸ”“";
        lockBox.classList.add("unlocked");
        burstHearts(16);
        setTimeout(()=> goTo("s2_start"), 480);
      } else {
        wrongPw("eh salahâ€¦ coba diinget-inget lagi ğŸ˜†");
      }
    });

    pw.addEventListener("keydown", (e)=>{
      if(e.key === "Enter") $("#btnUnlock").click();
    });

    /* =========================
       Start -> enable bg12 + romantis + slideshow 12
       (Background 12 jalan terus sampai pesan ultah selesai)
    ========================== */
    $("#btnStart").addEventListener("click", async ()=>{
      // start showing 12-photo background from here
      enableBg("12");
      state.slidesTimer12 = stopTimer(state.slidesTimer12);
      state.slidesTimer12 = startSlideshow("slides12", 4500);

      // move to bday screen
      goTo("s3_bday");

      // play romantis from 9s (fade)
      await switchAudio("romantis");
      burstHearts(18);
    });

    /* =========================
       Bday -> romantic screens
    ========================== */
    $("#btnToMsg1").addEventListener("click", ()=> goTo("s4_msg1"));

    document.querySelectorAll("[data-next]").forEach(btn=>{
      btn.addEventListener("click", ()=> goTo(btn.getAttribute("data-next")));
    });

    /* =========================
       Question logic
    ========================== */
    const qNotice = $("#qNotice");
    const btnQNext = $("#btnQNext");
    const btnRetry = $("#btnRetry");

    $("#btnNo").addEventListener("click", ()=>{
      qNotice.textContent =
        "Lohh.. ternyata kamu ga sayang aku ğŸ˜”\nselama ini jadi aku dibohongi?\njahat banget kamuâ€¦ ğŸ’”";
      burstHearts(2);
      btnQNext.classList.add("hidden");
      btnRetry.classList.remove("hidden");
    });

    btnRetry.addEventListener("click", ()=>{
      qNotice.textContent = "";
      btnRetry.classList.add("hidden");
    });

    $("#btnYes").addEventListener("click", ()=>{
      qNotice.textContent = "Aku juga sayang kamu kokkk.. banget malahan ğŸ¥°ğŸ’•";
      burstHearts(18);
      btnRetry.classList.add("hidden");
      btnQNext.classList.remove("hidden");
    });

    btnQNext.addEventListener("click", ()=>{
      qNotice.textContent = "";
      btnQNext.classList.add("hidden");
      btnRetry.classList.add("hidden");
      resetCandle();
      goTo("s11_candle");
      burstHearts(10);
      // romantis tetap lanjut sampai lilin padam
    });

    /* =========================
       Candle game (detail)
    ========================== */
    const flame = $("#flame");
    const smoke = $("#smoke");
    const cheer = $("#cheer");
    const btnCandleNext = $("#btnCandleNext");
    const barFill = $("#barFill");

    const cheerTexts = [
      "Heheâ€¦ pelan-pelan ya ğŸ˜†",
      "Dikit lagi sayang ğŸ’—",
      "Aku tau kamu bisa ğŸ«¶",
      "Semangaattt âœ¨",
      "AYO TIUP TERAKHIR ğŸ˜†ğŸ”¥",
      "Satu lagiâ€¦ satu lagiâ€¦ ğŸ¥¹"
    ];

    function resetCandle(){
      state.candleTaps = 0;
      flame.style.opacity = "1";
      flame.style.transform = "scale(1)";
      flame.classList.remove("hidden");
      smoke.classList.remove("show");
      btnCandleNext.classList.add("hidden");
      cheer.textContent = cheerTexts[0];
      barFill.style.width = "0%";
    }

    function updateFlame(progress){
      const p = Math.min(1, Math.max(0, progress));
      // shrink & fade gradually
      const scale = 1 - 0.58*p;
      const op = 1 - 0.88*p;
      flame.style.transform = `scale(${scale})`;
      flame.style.opacity = `${op}`;
      barFill.style.width = `${Math.round(p*100)}%`;
    }

    async function candleOut(){
      flame.classList.add("hidden");
      smoke.classList.add("show");
      burstHearts(24);

      // switch music to birthday (detik 9)
      await switchAudio("birthday");

      btnCandleNext.classList.remove("hidden");
      cheer.textContent = "Yeayyy! Lilinnya udah padam ğŸ¥¹ğŸ¤";
    }

    flame.addEventListener("click", async ()=>{
      state.candleTaps++;
      const progress = state.candleTaps / state.candleTarget;
      updateFlame(progress);

      // dynamic cheer
      const idx = Math.min(cheerTexts.length - 1, Math.floor(state.candleTaps / 2));
      cheer.textContent = cheerTexts[idx];

      burstHearts(3);

      if(state.candleTaps >= state.candleTarget){
        await candleOut();
      }
    });

    btnCandleNext.addEventListener("click", async ()=>{
      goTo("s12_letter");
      burstHearts(10);
      await sleep(520);
      startLetterTyping();
    });

    /* =========================
       Typewriter (super pelan) â€“ ultah & fotbar beda speed
    ========================== */
    const typedEl = $("#typed");
    const btnLetterNext = $("#btnLetterNext");

    const birthdayLetter =
`Selamat ulang tahun, sayangku ğŸ¤

Hari ini hari yang spesial,
Hari ini hari yang spesial, 
hari lahir seseorang yang paling aku sayang.
Aku bersyukur bisa ada di hidup kamu
dan merayakan hari ini bareng kamu.
Aku bersyukur bisa ada di hidup kamu 
dan merayakan hari ini bareng kamu. 

Di umur kamu yang ke-18 ini,
aku berdoa semoga kamu selalu sehat,
panjang umur, rezekinya lancar,
Di umur kamu yang ke-18 ini, 
aku berdoa semoga kamu selalu sehat, 
panjang umur, rezekinya lancar, 
dan setiap langkah hidupmu dipermudah.

Semoga urusan kuliah kamu dimudahkan,
belajar makin rajin,
dan selalu nurut serta berbakti pada orang tua.
Semoga urusan kuliah kamu dimudahkan, 
belajar makin rajin, 
dan selalu nurut serta berbakti pada orang tua. 

Terima kasih sudah hadir di hidupku.
Aku ingin terus tumbuh bareng kamu
Aku ingin terus tumbuh bareng kamu 
dan berjalan bersama sampai akhir hayat nanti.
Aku sayang kamu ğŸ¤

â€” fayruz zam`;

    const fotbarText =
`Sayang baca ini baik-baik yaaâ€¦

Kalau capek, pulang ke aku.
Kalau sedih, cerita ke aku.
Kalau seneng, bagi ke aku juga.
kita harus bareng terus.

kita harus bareng terus.
Kita usahakan rumah itu yaâ€¦
tempat paling tenang,
tempat aku dan kamu saling jaga.

Aku sayang kamu,
jangan kemana-mana ğŸ¤`;

    function charDelay(ch, base){
      // super pelan + dramatis
      if(ch === "\n") return base + 110;
      if(".,!?".includes(ch)) return base + 220;
      if("â€¦".includes(ch)) return base + 320;
      if(ch === " ") return base - 8;
      return base;
    }
    function extraPause(text, i, longPause){
      // pause on paragraph breaks
      if(text.slice(i, i+2) === "\n\n") return longPause;
      return 0;
    }

    async function typeText(el, fullText, baseDelay, paraPause, onDone){
      state.typingRunning = true;
      el.textContent = "";

      for(let i=0;i<fullText.length;i++){
        if(!state.typingRunning) return;
        const ch = fullText[i];
        el.textContent += ch;

        const p = extraPause(fullText, i, paraPause);
        const d = charDelay(ch, baseDelay);
        await sleep(d + p);
      }

      // cursor at end
      const cursor = document.createElement("span");
      cursor.className = "cursor";
      cursor.textContent = "|";
      el.appendChild(document.createTextNode(" "));
      el.appendChild(cursor);

      state.typingRunning = false;
      onDone && onDone();
    }

    async function startLetterTyping(){
      if(state.typingRunning) return;
      btnLetterNext.classList.add("hidden");

      // ultah: SUPER PELAN
      await typeText(typedEl, birthdayLetter, 42, 520, ()=>{
        btnLetterNext.classList.remove("hidden");
        burstHearts(18);
      });
    }

    /* =========================
       Letter -> Fotbar
       - background 12 stays until letter finishes + button clicked
       - after click: switch to fotbar bg, play lagu3 from 9s (fade)
       - type fotbar paling pelan
    ========================== */
    const fotbarEl = $("#fotbarTyped");
    const btnRestart = $("#btnRestart");

    btnLetterNext.addEventListener("click", async ()=>{
      // NOW switch background to fotbar
      enableBg("fotbar");

      // stop slideshow 12 timer (optional, but bg12 already hidden)
      state.slidesTimer12 = stopTimer(state.slidesTimer12);

      // start fotbar slideshow
      state.slidesTimerFotbar = stopTimer(state.slidesTimerFotbar);
      state.slidesTimerFotbar = startSlideshow("slidesFotbar", 5200);

      // move screen
      goTo("s13_fotbar");

      // start lagu3 from 9s (fade)
      await switchAudio("lagu3");

      // type fotbar: PALING PELAN
      await sleep(450);
      fotbarEl.textContent = "";
      await typeText(fotbarEl, fotbarText, 58, 720, ()=> burstHearts(16));
    });

    /* =========================
       Restart
    ========================== */
    btnRestart.addEventListener("click", async ()=>{
      // reset everything
      await stopAllAudio();
      state.slidesTimer12 = stopTimer(state.slidesTimer12);
      state.slidesTimerFotbar = stopTimer(state.slidesTimerFotbar);
      enableBg(null);

      // reset UI
      document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active","leaving"));
      $("#s1_lock").classList.add("active");
      state.current = "s1_lock";

      // reset lock
      $("#pw").value = "";
      $("#pwErr").textContent = "";
      lockIcon.textContent = "ğŸ”’";
      lockBox.classList.remove("unlocked");

      // reset candle
      resetCandle();

      // reset letter screen
      typedEl.textContent = "";
      btnLetterNext.classList.add("hidden");
      fotbarEl.textContent = "";
      burstHearts(10);
    });

    /* =========================
       Init (nothing else)
    ========================== */
    // Background 12 must start only after user clicks MULAI (gesture) => done.
  </script>
</body>
</html>
