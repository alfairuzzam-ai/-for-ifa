<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>For Ifa ü§ç</title>

  <style>
    :root{
      --pink:#ff5fa2;
      --pink2:#ff7fbf;
      --bg1:#ff6aa8;
      --bg2:#ff3b8a;
      --dark:rgba(10,10,12,.72);
      --glass:rgba(18,18,22,.55);
      --stroke:rgba(255,255,255,.14);
      --shadow: 0 18px 55px rgba(0,0,0,.40);
      --radius: 26px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:#fff;
      overflow:hidden;
      background: radial-gradient(1200px 800px at 30% 20%, rgba(255,255,255,.14), transparent 60%),
                  linear-gradient(135deg, var(--bg1), var(--bg2));
    }

    /* ===== BACKGROUND LAYERS (NO TUMPUK) ===== */
    .bg{
      position:fixed; inset:0;
      z-index:-2;
      background: radial-gradient(900px 600px at 20% 15%, rgba(255,255,255,.15), transparent 55%),
                  linear-gradient(135deg, var(--bg1), var(--bg2));
      transition: filter .6s ease, transform .6s ease;
    }

    .bgPhoto{
      position:fixed; inset:0;
      z-index:-3;
      background-size:cover;
      background-position:center;
      opacity:0;
      transform:scale(1.03);
      transition: opacity .8s ease, transform 1.2s ease;
    }
    .bgPhoto.show{ opacity:1; transform:scale(1.00); }

    .bgOverlay{
      position:fixed; inset:0;
      z-index:-1;
      background: rgba(0,0,0,.35);
      opacity:0;
      transition: opacity .6s ease;
    }
    .bgOverlay.show{opacity:1}

    .blurOn .bg{ filter: blur(10px) saturate(1.1) brightness(.92); transform:scale(1.02); }
    .blurOn .bgOverlay{ opacity:1; }

    /* ===== CENTER WRAP ===== */
    .wrap{
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: clamp(14px, 3vw, 26px);
    }

    .card{
      width:min(520px, 92vw);
      background: linear-gradient(180deg, rgba(20,20,24,.72), rgba(12,12,14,.65));
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding: clamp(18px, 3.2vw, 26px);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      position:relative;
      overflow:hidden;
    }

    .card::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(520px 220px at 30% 0%, rgba(255,105,180,.20), transparent 60%),
                  radial-gradient(520px 220px at 80% 20%, rgba(255,255,255,.10), transparent 60%);
      pointer-events:none;
    }

    .title{
      font-weight:800;
      letter-spacing:.2px;
      font-size: clamp(18px, 3.4vw, 22px);
      margin:0 0 8px;
      text-align:center;
    }

    .sub{
      margin:0 auto 18px;
      text-align:center;
      opacity:.92;
      line-height:1.55;
      font-size: clamp(14px, 3.1vw, 15.5px);
      max-width: 40ch;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding: 12px 18px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color:#fff;
      font-weight:700;
      cursor:pointer;
      transition: transform .12s ease, filter .2s ease, background .2s ease;
      user-select:none;
    }
    .pill:hover{ filter:brightness(1.05); }
    .pill:active{ transform: scale(.98); }

    .pill.primary{
      background: linear-gradient(135deg, #ff4d93, #ff84c2);
      border:1px solid rgba(255,255,255,.22);
      color:#1a0d12;
    }

    .pill.ghost{
      background: rgba(255,255,255,.12);
    }

    .row{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top:14px;
      position:relative;
      z-index:2;
    }

    .input{
      width:min(320px, 90%);
      margin: 0 auto;
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:center;
      position:relative;
      z-index:2;
    }
    input{
      width:100%;
      padding: 13px 16px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.14);
      color:#fff;
      outline:none;
      font-size: 15px;
      text-align:center;
    }
    input::placeholder{ color: rgba(255,255,255,.70); }

    .msg{
      text-align:center;
      margin-top:10px;
      min-height: 22px;
      opacity:.95;
      font-size: 14px;
      position:relative;
      z-index:2;
    }

    .fadeIn{
      animation: fadeIn .45s ease both;
    }
    @keyframes fadeIn{
      from{ opacity:0; transform: translateY(6px); }
      to{ opacity:1; transform: translateY(0); }
    }

    /* ===== LOVE QUESTION ===== */
    .btnYes{ background: linear-gradient(135deg, #ff4d93, #ffb0d6); color:#1a0d12; border:1px solid rgba(255,255,255,.22); }
    .btnNo { background: rgba(255,255,255,.10); border:1px solid rgba(255,255,255,.20); }

    .shake{
      animation: shake .45s ease;
    }
    @keyframes shake{
      0%,100%{ transform: translateX(0) }
      20%{ transform: translateX(-8px) }
      40%{ transform: translateX(8px) }
      60%{ transform: translateX(-6px) }
      80%{ transform: translateX(6px) }
    }

    /* ===== HEARTS (YES) ===== */
    .heart{
      position:fixed;
      font-size: 18px;
      pointer-events:none;
      z-index:999;
      animation: floatUp 1.9s ease forwards;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.35));
    }
    @keyframes floatUp{
      0%{ transform: translateY(0) scale(.9); opacity:0; }
      12%{ opacity:1; }
      100%{ transform: translateY(-130px) scale(1.25); opacity:0; }
    }

    /* ===== CANDLE 18 GAME ===== */
    .gameWrap{
      display:flex;
      justify-content:center;
      margin: 12px 0 6px;
      position:relative;
      z-index:2;
    }

    .cake{
      width:min(360px, 92vw);
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      padding: 16px 14px 14px;
      text-align:center;
    }

    .candles{
      display:flex;
      justify-content:center;
      align-items:flex-end;
      gap:18px;
      margin-top: 8px;
    }

    .digit{
      position:relative;
      width:120px;
      height:150px;
    }

    /* digit "1" candle */
    .one{
      position:absolute;
      left:50%; bottom:0;
      width:26px; height:118px;
      transform: translateX(-50%);
      border-radius: 16px;
      background: linear-gradient(180deg, #ffe6f1, #ff6aa8);
      box-shadow: inset 0 0 0 2px rgba(255,255,255,.22);
    }

    /* digit "8" candle (two loops) */
    .eightTop,.eightBottom{
      position:absolute;
      left:50%;
      width:96px;
      height:56px;
      transform: translateX(-50%);
      border-radius: 44px;
      background: linear-gradient(180deg, #ffe6f1, #ff6aa8);
      box-shadow: inset 0 0 0 2px rgba(255,255,255,.22);
    }
    .eightTop{ bottom:64px; }
    .eightBottom{ bottom:0; }

    .flame{
      position:absolute;
      left:50%;
      top:-26px;
      width:22px;
      height:28px;
      transform: translateX(-50%);
      border-radius: 50% 50% 50% 50%;
      background: radial-gradient(circle at 40% 35%, #fff6a6 0 35%, #ff7a2f 36% 75%, #ff3d8c 76% 100%);
      filter: drop-shadow(0 10px 18px rgba(255,105,180,.35));
      animation: flicker .65s infinite;
      cursor:pointer;
      user-select:none;
    }
    .flame:active{ transform: translateX(-50%) scale(.96); }
    @keyframes flicker{
      0%,100%{ transform: translateX(-50%) rotate(-2deg) scale(1); opacity:1; }
      50%{ transform: translateX(-50%) rotate(2deg) scale(1.05); opacity:.75; }
    }

    .flame.off{
      opacity:0;
      animation:none;
      pointer-events:none;
    }

    .meter{
      width: min(320px, 92%);
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.16);
      margin: 12px auto 0;
      overflow:hidden;
    }
    .meter > div{
      height:100%;
      width:0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #ff4d93, #ffb0d6);
      transition: width .18s ease;
    }

    .hint{
      margin: 10px 0 0;
      opacity:.95;
      font-size: 13.5px;
      line-height:1.45;
    }

    /* ===== CONFETTI ===== */
    .confetti{
      position:fixed;
      top:-12px;
      width:10px; height:14px;
      border-radius: 3px;
      background: #ff6aa8;
      opacity:.92;
      z-index:998;
      animation: fall 5.8s linear forwards;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.18));
    }
    @keyframes fall{
      to{
        transform: translateY(110vh) rotate(420deg);
        opacity:.9;
      }
    }

    /* ===== BIG TEXT AREA ===== */
    .typedBox{
      margin-top: 12px;
      padding: 14px 14px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      text-align:left;
      white-space:pre-line;
      line-height:1.7;
      font-size: 14.5px;
      position:relative;
      z-index:2;
    }

    /* ===== STAGE 9 FULLSCREEN ===== */
    .full{
      position:fixed; inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding: clamp(14px, 3vw, 28px);
      z-index: 50;
      background: #000;
    }
    .full.show{ display:flex; }

    .fullLayerA, .fullLayerB{
      position:absolute; inset:0;
      background-size:cover;
      background-position:center;
      opacity:0;
      transform: scale(1.03);
      transition: opacity 1.25s ease, transform 2.3s ease;
    }
    .fullLayerA.show, .fullLayerB.show{
      opacity:1;
      transform: scale(1.00);
    }

    .fullShade{
      position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(0,0,0,.42), rgba(0,0,0,.55));
    }

    .fullContent{
      position:relative;
      width: min(720px, 92vw);
      text-align:center;
      z-index:2;
      color:#fff;
    }

    .finalTitle{
      font-size: clamp(18px, 4vw, 26px);
      font-weight: 900;
      letter-spacing:.2px;
      margin: 0 0 10px;
      text-shadow: 0 10px 22px rgba(0,0,0,.45);
    }

    .finalText{
      white-space:pre-line;
      line-height:1.8;
      font-size: clamp(14px, 3.6vw, 18px);
      text-shadow: 0 10px 22px rgba(0,0,0,.55);
      padding: 10px 8px;
      min-height: 40vh;
    }

    .bottomBar{
      display:flex;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 10px;
    }

    /* ===== UTILS ===== */
    .hidden{ display:none !important; }
    .center{ text-align:center; }

    /* Mobile tweaks */
    @media (max-width:420px){
      .card{ border-radius: 22px; }
      .digit{ width:102px; height:142px; }
      .eightTop,.eightBottom{ width:88px; }
    }
  </style>
</head>

<body>
  <!-- BACKGROUND: gradient + (from stage2) foto12 blur -->
  <div class="bgPhoto" id="bgPhoto"></div>
  <div class="bg" id="bg"></div>
  <div class="bgOverlay" id="bgOverlay"></div>

  <div class="wrap">
    <div class="card" id="card">
      <h1 class="title" id="title">üîê Password Cinta</h1>
      <p class="sub" id="sub">Masukin passwordnya dulu ya sayang ü§ç</p>

      <!-- STAGE CONTENTS -->
      <div id="stageArea">

        <!-- STAGE 0: PASSWORD -->
        <div id="stage0" class="fadeIn">
          <div class="input">
            <input id="pass" type="password" placeholder="password: sayang ifa" autocomplete="off" />
            <button class="pill primary" id="btnUnlock">Buka üíñ</button>
          </div>
          <div class="msg" id="msg0"></div>
        </div>

        <!-- STAGE 1 -->
        <div id="stage1" class="hidden">
          <p class="sub center fadeIn">
            Pencet tombol mulainya ya sayang,<br>
            janji deh‚Ä¶ kamu nggak bakal nyesel kok ü§ç
          </p>
          <div class="row">
            <button class="pill primary" id="btnStart">Mulai ‚ù§Ô∏è</button>
          </div>
        </div>

        <!-- STAGE 2-6 shared -->
        <div id="stage2to6" class="hidden">
          <h2 class="title fadeIn" id="stageTitle">üéÇ Selamat ulang tahun, sayangku ü§ç</h2>
          <p class="sub fadeIn" id="stageText"></p>

          <div id="loveQ" class="hidden">
            <p class="sub center fadeIn" style="margin-top:10px;font-weight:800">
              Kamu sayang aku kan?
            </p>
            <div class="row">
              <button class="pill btnYes" id="btnYes">IYA ‚ù§Ô∏è</button>
              <button class="pill btnNo"  id="btnNo">TIDAK üíî</button>
            </div>
            <div class="msg" id="loveMsg"></div>
          </div>

          <div class="row" id="nextRow">
            <button class="pill primary" id="btnNext">Lanjut</button>
          </div>
          <div class="msg" id="msg"></div>
        </div>

        <!-- STAGE 7: CANDLE GAME -->
        <div id="stage7" class="hidden">
          <h2 class="title fadeIn">üïØÔ∏è Tiup Lilinnya yaa üéÇ</h2>
          <p class="sub fadeIn">Tap apinya beberapa kali sampai padam ya sayang ü§ç</p>

          <div class="gameWrap">
            <div class="cake" id="cake">
              <div class="candles">
                <div class="digit">
                  <div class="one"></div>
                  <div class="flame" id="flame1" title="tap"></div>
                </div>

                <div class="digit">
                  <div class="eightTop"></div>
                  <div class="eightBottom"></div>
                  <div class="flame" id="flame8" title="tap"></div>
                </div>
              </div>

              <div class="meter" aria-label="progress">
                <div id="meterFill"></div>
              </div>

              <p class="hint" id="candleHint">Ayo‚Ä¶ pelan-pelan‚Ä¶ hembusnya yang kuat üòôüí®</p>
            </div>
          </div>

          <div class="row">
            <button class="pill ghost hidden" id="btnToLetter">Lanjut ü§ç</button>
          </div>
        </div>

        <!-- STAGE 8: BIRTHDAY LETTER (typed slow) -->
        <div id="stage8" class="hidden">
          <h2 class="title fadeIn">üíå Buat kamu‚Ä¶</h2>
          <div class="typedBox" id="bdayBox"></div>

          <div class="row">
            <button class="pill primary hidden" id="btnToFinal">Next lagi sayang ü§ç</button>
            <button class="pill ghost" id="btnRestart1">Ulang dari awal üîÅ</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- STAGE 9 FULLSCREEN -->
  <div class="full" id="finalScreen">
    <div class="fullLayerA" id="finalA"></div>
    <div class="fullLayerB" id="finalB"></div>
    <div class="fullShade"></div>

    <div class="fullContent">
      <h2 class="finalTitle">sayang baca ini yaa‚Ä¶ ü§ç</h2>
      <div class="finalText" id="finalText"></div>
      <div class="bottomBar">
        <button class="pill ghost" id="btnRestart2">Ulang dari awal üîÅ</button>
      </div>
    </div>
  </div>

  <!-- AUDIO -->
  <audio id="romantis" src="romantis.mp3" preload="auto"></audio>
  <audio id="birthday"  src="happybirthday.mp3" preload="auto"></audio>
  <audio id="rumah"     src="lagu3.mp3" preload="auto"></audio>

  <script>
    // ===== FILES =====
    const BG_STAGE2 = "foto12.jpeg"; // background blur mulai stage2

    // fotbar untuk stage 9 (FULLSCREEN)
    const FOTBAR = ["foto3.jpg","foto4.jpg","foto5.jpg","foto12.jpeg"];

    // ===== TEXTS =====
    const birthdayMsg =
`Selamat ulang tahun, sayangku ü§ç

Hari ini hari yang spesial, 
hari lahir seseorang yang paling aku sayang.
Aku bersyukur bisa ada di hidup kamu 
dan merayakan hari ini bareng kamu. 

Di umur kamu yang ke-18 ini, 
aku berdoa semoga kamu selalu sehat, 
panjang umur, rezekinya lancar, 
dan setiap langkah hidupmu dipermudah.

Semoga urusan kuliah kamu dimudahkan, 
belajar makin rajin, 
dan selalu nurut serta berbakti pada orang tua. 

Terima kasih sudah hadir di hidupku.
Aku ingin terus tumbuh bareng kamu 
dan berjalan bersama sampai akhir hayat nanti.
Aku sayang kamu ü§ç

‚Äî fayruz zam`;

    const finalMsg =
`sayang baca ini yaa... 

Kalau capek, pulang ke aku.
Kalau sedih, cerita ke aku.
Kalau seneng, bagi ke aku juga.
kita harus bareng terus.

Kita usahakan rumah itu ya‚Ä¶
tempat paling tenang,
tempat aku dan kamu saling jaga.

Aku sayang kamu,
jangan kemana-mana ü§ç`;

    // Stage 2-6 config
    const stageFlow = [
      // stage2
      {
        title: "üéÇ Selamat ulang tahun, sayangku ü§ç",
        text: "", // biar clean
        button: "Lanjut",
        showLoveQ: false
      },
      // stage3
      {
        title: "ü§ç",
        text: "Pelan-pelan yaa‚Ä¶\naku di sini nemenin kamu ü§ç",
        button: "Lanjut lagi",
        showLoveQ: false
      },
      // stage4
      {
        title: "ü´∂",
        text: "Aku tahu kamu kuat,\ntapi kamu nggak harus sendiri‚Ä¶",
        button: "Sekali lagi yaa",
        showLoveQ: false
      },
      // stage5
      {
        title: "üíó",
        text: "Sedikit lagi‚Ä¶\njangan kemana-mana ya sayang ü§ç",
        button: "Terakhir, janji",
        showLoveQ: false
      },
      // stage6 (love question)
      {
        title: "üíå",
        text: "",
        button: "",
        showLoveQ: true
      }
    ];

    // ===== ELEMENTS =====
    const body = document.body;
    const bg = document.getElementById("bg");
    const bgPhoto = document.getElementById("bgPhoto");
    const bgOverlay = document.getElementById("bgOverlay");

    const title = document.getElementById("title");
    const sub = document.getElementById("sub");

    const stage0 = document.getElementById("stage0");
    const stage1 = document.getElementById("stage1");
    const stage2to6 = document.getElementById("stage2to6");
    const stage7 = document.getElementById("stage7");
    const stage8 = document.getElementById("stage8");

    const pass = document.getElementById("pass");
    const btnUnlock = document.getElementById("btnUnlock");
    const msg0 = document.getElementById("msg0");

    const btnStart = document.getElementById("btnStart");

    const stageTitle = document.getElementById("stageTitle");
    const stageText = document.getElementById("stageText");
    const btnNext = document.getElementById("btnNext");
    const nextRow = document.getElementById("nextRow");
    const msg = document.getElementById("msg");

    const loveQ = document.getElementById("loveQ");
    const btnYes = document.getElementById("btnYes");
    const btnNo = document.getElementById("btnNo");
    const loveMsg = document.getElementById("loveMsg");

    const flame1 = document.getElementById("flame1");
    const flame8 = document.getElementById("flame8");
    const meterFill = document.getElementById("meterFill");
    const candleHint = document.getElementById("candleHint");
    const btnToLetter = document.getElementById("btnToLetter");

    const bdayBox = document.getElementById("bdayBox");
    const btnToFinal = document.getElementById("btnToFinal");
    const btnRestart1 = document.getElementById("btnRestart1");

    const finalScreen = document.getElementById("finalScreen");
    const finalA = document.getElementById("finalA");
    const finalB = document.getElementById("finalB");
    const finalText = document.getElementById("finalText");
    const btnRestart2 = document.getElementById("btnRestart2");

    // Audios
    const romantis = document.getElementById("romantis");
    const birthday = document.getElementById("birthday");
    const rumah = document.getElementById("rumah");

    // ===== HELPERS =====
    function show(el){ el.classList.remove("hidden"); }
    function hide(el){ el.classList.add("hidden"); }

    function setBlurBgPhoto(src){
      bgPhoto.style.backgroundImage = `url('${src}')`;
      bgPhoto.classList.add("show");
      bgOverlay.classList.add("show");
      body.classList.add("blurOn");
    }

    function setGradientBg(){
      bgPhoto.classList.remove("show");
      bgOverlay.classList.remove("show");
      body.classList.remove("blurOn");
    }

    function swapStage(keepTitle, keepSub){
      // just helper if needed
      if(!keepTitle) title.textContent = "";
      if(!keepSub) sub.textContent = "";
    }

    // typewriter (slower)
    async function typeText(el, text, baseDelay=95, jitter=45){
      el.textContent = "";
      for(let i=0;i<text.length;i++){
        el.textContent += text[i];
        const d = baseDelay + Math.floor(Math.random()*jitter);
        await new Promise(r => setTimeout(r, d));
      }
    }

    // hearts burst
    function heartBurst(count=18){
      for(let i=0;i<count;i++){
        const h = document.createElement("div");
        h.className = "heart";
        h.textContent = "üíó";
        h.style.left = (Math.random()*80 + 10) + "vw";
        h.style.top  = (Math.random()*20 + 55) + "vh";
        h.style.fontSize = (Math.random()*10 + 16) + "px";
        h.style.animationDuration = (Math.random()*0.6 + 1.6) + "s";
        document.body.appendChild(h);
        setTimeout(()=>h.remove(), 2200);
      }
    }

    // confetti pink (slow-ish)
    function confettiPink(total=240){
      for(let i=0;i<total;i++){
        const c = document.createElement("div");
        c.className = "confetti";
        c.style.left = (Math.random()*100) + "vw";
        c.style.background = `hsl(${330 + Math.random()*12}, 85%, ${65 + Math.random()*10}%)`;
        c.style.animationDuration = (Math.random()*2.0 + 4.8) + "s";
        c.style.transform = `rotate(${Math.random()*360}deg)`;
        document.body.appendChild(c);
        setTimeout(()=>c.remove(), 6500);
      }
    }

    // safe audio play (mobile)
    async function playAudio(aud, startAt){
      try{
        if(typeof startAt === "number") aud.currentTime = startAt;
        await aud.play();
      }catch(e){
        // kalau autoplay diblok, user tinggal tap tombol lagi
      }
    }

    function stopAudio(aud){
      try{ aud.pause(); }catch(e){}
    }

    // ===== APP STATE =====
    let flowIndex = 0;     // stage2..6 index
    let candleProgress = 0;
    let candleDone = false;

    // stage 9 slideshow
    let finalIdx = 0;
    let finalUsingA = true;
    let finalTimer = null;

    function renderFlow(){
      const s = stageFlow[flowIndex];
      stageTitle.textContent = s.title;
      stageText.textContent = s.text;

      if(s.showLoveQ){
        hide(nextRow);
        show(loveQ);
        loveMsg.textContent = "";
        loveMsg.classList.remove("shake");
      }else{
        hide(loveQ);
        show(nextRow);
        btnNext.textContent = s.button;
      }

      // small fade message area reset
      msg.textContent = "";
      stageTitle.classList.remove("fadeIn"); stageText.classList.remove("fadeIn");
      void stageTitle.offsetWidth; // reflow
      stageTitle.classList.add("fadeIn"); stageText.classList.add("fadeIn");
    }

    // ===== STAGE TRANSITIONS =====
    function goStage1(){
      title.textContent = "ü§ç";
      sub.textContent = "";
      hide(stage0);
      show(stage1);
      stage1.classList.add("fadeIn");
    }

    function goStage2(){
      // set background blur foto12
      setBlurBgPhoto(BG_STAGE2);

      // show flow UI
      hide(stage1);
      show(stage2to6);

      // start romantis ONLY when entering stage2 (user gesture from btnStart)
      stopAudio(birthday);
      stopAudio(rumah);
      romantis.loop = true;
      playAudio(romantis, 6);

      flowIndex = 0;
      renderFlow();
    }

    function goStage7(){
      hide(stage2to6);
      show(stage7);
      stage7.classList.add("fadeIn");

      candleProgress = 0;
      candleDone = false;
      meterFill.style.width = "0%";
      flame1.classList.remove("off");
      flame8.classList.remove("off");
      btnToLetter.classList.add("hidden");
      candleHint.textContent = "Ayo‚Ä¶ pelan-pelan‚Ä¶ hembusnya yang kuat üòôüí®";
    }

    async function goStage8(){
      hide(stage7);
      show(stage8);
      stage8.classList.add("fadeIn");

      bdayBox.textContent = "";
      btnToFinal.classList.add("hidden");

      // typing slower
      await typeText(bdayBox, birthdayMsg, 100, 55);

      btnToFinal.classList.remove("hidden");
    }

    function goStage9(){
      // stage9 full screen + fotbar only
      finalScreen.classList.add("show");

      // stop other audios
      stopAudio(romantis);
      // birthday boleh tetap jalan, tapi biar clean kita stop
      stopAudio(birthday);

      rumah.loop = true;
      playAudio(rumah, 10);

      // setup layers
      finalA.style.backgroundImage = `url('${FOTBAR[0]}')`;
      finalB.style.backgroundImage = `url('${FOTBAR[1]}')`;
      finalA.classList.add("show");
      finalB.classList.remove("show");
      finalIdx = 1;
      finalUsingA = true;

      // type final slower banget biar ngahayati
      finalText.textContent = "";
      typeText(finalText, finalMsg, 140, 70);

      // slideshow timer (slow fade)
      if(finalTimer) clearInterval(finalTimer);
      finalTimer = setInterval(()=>{
        finalIdx = (finalIdx + 1) % FOTBAR.length;

        const nextSrc = FOTBAR[finalIdx];
        if(finalUsingA){
          finalB.style.backgroundImage = `url('${nextSrc}')`;
          finalB.classList.add("show");
          finalA.classList.remove("show");
        }else{
          finalA.style.backgroundImage = `url('${nextSrc}')`;
          finalA.classList.add("show");
          finalB.classList.remove("show");
        }
        finalUsingA = !finalUsingA;
      }, 6500); // 6.5 detik per foto biar ga skip
    }

    function restartAll(){
      // stop everything
      stopAudio(romantis); stopAudio(birthday); stopAudio(rumah);
      romantis.currentTime = 0; birthday.currentTime = 0; rumah.currentTime = 0;

      // hide screens
      finalScreen.classList.remove("show");
      if(finalTimer) clearInterval(finalTimer);

      // reset background
      setGradientBg();

      // reset stages
      show(stage0);
      hide(stage1); hide(stage2to6); hide(stage7); hide(stage8);

      title.textContent = "üîê Password Cinta";
      sub.textContent = "Masukin passwordnya dulu ya sayang ü§ç";
      msg0.textContent = "";
      pass.value = "";

      flowIndex = 0;
      candleProgress = 0;
      candleDone = false;
      meterFill.style.width = "0%";
      bdayBox.textContent = "";
      finalText.textContent = "";
    }

    // ===== EVENTS =====
    btnUnlock.addEventListener("click", ()=>{
      const p = (pass.value || "").trim().toLowerCase();
      if(p === "sayang ifa"){
        msg0.textContent = "Oke‚Ä¶ masuk ya sayang ü§ç";
        msg0.classList.add("fadeIn");
        setTimeout(goStage1, 250);
      }else{
        msg0.textContent = "Passwordnya salah ü•∫ coba lagi ya‚Ä¶";
        msg0.classList.remove("fadeIn");
        void msg0.offsetWidth;
        msg0.classList.add("fadeIn");
      }
    });

    // enter key
    pass.addEventListener("keydown",(e)=>{
      if(e.key==="Enter") btnUnlock.click();
    });

    btnStart.addEventListener("click", ()=>{
      goStage2();
    });

    btnNext.addEventListener("click", ()=>{
      // smooth stage transition
      stage2to6.classList.remove("fadeIn");
      void stage2to6.offsetWidth;
      stage2to6.classList.add("fadeIn");

      flowIndex++;
      if(flowIndex >= stageFlow.length){
        // should never happen (last is loveQ)
        flowIndex = stageFlow.length - 1;
      }
      renderFlow();
    });

    // LOVE QUESTION
    btnYes.addEventListener("click", ()=>{
      loveMsg.textContent = "Iyaa‚Ä¶ aku juga sayang kamu ü§ç\nlanjut yaa‚Ä¶";
      loveMsg.classList.remove("shake");
      loveMsg.classList.add("fadeIn");

      heartBurst(22);

      // lanjut ke mini game
      setTimeout(goStage7, 750);
    });

    btnNo.addEventListener("click", ()=>{
      loveMsg.textContent = "kok nggak sayang‚Ä¶\nkemarin katanya sayang banget ü•∫\nayo jujur, coba lagi ya";
      loveMsg.classList.remove("fadeIn");
      loveMsg.classList.add("shake");
      setTimeout(()=> loveMsg.classList.remove("shake"), 520);
    });

    // CANDLE GAME: tap flames several times
    function tapCandle(){
      if(candleDone) return;
      candleProgress++;
      const need = 8; // makin niat: 8 tap
      const pct = Math.min(100, Math.round((candleProgress/need)*100));
      meterFill.style.width = pct + "%";

      const hints = [
        "Hehe‚Ä¶ pelan dulu üòôüí®",
        "Ayo lagi‚Ä¶ sedikit üòôüí®",
        "Wuih hampir‚Ä¶ üòöüí®",
        "Nah gitu‚Ä¶ üòôüí®",
        "Kuat banget‚Ä¶ üò≥üí®"
      ];
      candleHint.textContent = hints[Math.min(hints.length-1, Math.floor(candleProgress/2))];

      if(candleProgress >= need){
        candleDone = true;

        // turn off flames after 2 sec (sesuai request lilin mati 2 detik)
        candleHint.textContent = "Oke‚Ä¶ sekarang tunggu 2 detik yaa ü§ç";
        setTimeout(()=>{
          flame1.classList.add("off");
          flame8.classList.add("off");

          // stop romantis, start birthday at sec 8
          stopAudio(romantis);
          playAudio(birthday, 8);

          confettiPink(280);

          btnToLetter.classList.remove("hidden");
          btnToLetter.textContent = "Lanjut ü§ç";
        }, 2000);
      }
    }
    flame1.addEventListener("click", tapCandle);
    flame8.addEventListener("click", tapCandle);

    btnToLetter.addEventListener("click", ()=>{
      goStage8();
    });

    btnToFinal.addEventListener("click", ()=>{
      goStage9();
    });

    btnRestart1.addEventListener("click", restartAll);
    btnRestart2.addEventListener("click", restartAll);

    // ===== PRELOAD IMPORTANT IMAGES (avoid blank / skip) =====
    // Preload bg + fotbar first for smoother
    const preload = [BG_STAGE2, ...FOTBAR];
    preload.forEach(src=>{
      const img = new Image();
      img.src = src;
    });

    // start state
    restartAll();
  </script>
</body>
</html>
